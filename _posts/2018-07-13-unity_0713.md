---
layout: post
title: "Unity CatCoding Tutorial 메모 (5)"
tags: 
date: 2018-07-13 +0900
categories: Unity
comments: false
---
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

## 주소

[https://catlikecoding.com/unity/tutorials/](https://catlikecoding.com/unity/tutorials/)

---

## Rendering 2 Shader Fundamentals

### 1. Unity shader 기초.

> [Unity Link](https://docs.unity3d.com/Manual/ShadersOverview.html)

현재 `2018.1` 버전 기준으로 `Unity` 쉐이더는 3가지로 나뉜다.

1. `Surface Shaders` 빛, 그림자 등과 관련된 쉐이더를 만들기 위해 쓰이는 쉐이더 타입이다. `Unity` 의 독자적인 라이팅 파이프라인을 사용해서 `forward rendering` & `deferred lighting` 등을 지원한다. 만약 빛과 관련되지 않은 쉐이더를 만들고 싶다면, 성능 낭비를 막기 위해 `Vertex and Fragment Shaders` 을 사용하는 것이 낫다고 한다.
  * `Surface Shader` 의 예제는 다음 [Link](https://docs.unity3d.com/Manual/SL-SurfaceShaderExamples.html) 에서 볼 수 있다.

`Surface Shader` 에서 기존 일반 렌더링시에 다음과 같은 구조체의 각 변수들에 값을 넣음으로써 `Unity` 가 렌더링 연산을 할 수 있도록 도와준다.

{% highlight csharp %}
struct SurfaceOutputStandard
{
    fixed3 Albedo;      // base (diffuse or specular) color
    fixed3 Normal;      // tangent space normal, if written
    half3 Emission;
    half Metallic;      // 0=non-metal, 1=metal
    half Smoothness;    // 0=rough, 1=smooth
    half Occlusion;     // occlusion (default 1)
    fixed Alpha;        // alpha for transparencies
};
struct SurfaceOutputStandardSpecular
{
    fixed3 Albedo;      // diffuse color
    fixed3 Specular;    // specular color
    fixed3 Normal;      // tangent space normal, if written
    half3 Emission;
    half Smoothness;    // 0=rough, 1=smooth
    half Occlusion;     // occlusion (default 1)
    fixed Alpha;        // alpha for transparencies
};
{% endhighlight %}

위 구조체들은 `Unity 5` 에서부터 지원되는 `PBR` 라이팅 모델에 사용되는 것이다. 간혹 `SurfaceOutput` 으로 시작하는 결과 구조체도 볼 수 있는데 이것은 `Metallic` 이나 `Smoothness` 같은 변수가 없는 대신에 `Specular` 같은 흔히 일반 렌더링에서 볼 수 있는 것들이 존재한다.

{% highlight csharp %}
void surf (Input IN, inout SurfaceOutput o) {
    o.Albedo = 1;
}
// 라던가,

void surf (Input IN, inout SurfaceOutputStandard o) {
	// Albedo comes from a texture tinted by color
	fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color;
	o.Albedo = c.rgb;
	// Metallic and smoothness come from slider variables
	o.Metallic = _Metallic;
	o.Smoothness = _Glossiness;
	o.Alpha = c.a;
}
// 처럼.. o 는 다양하다.
{% endhighlight %}

`Surface Shader` 의 함수 본문은 `CGPROGRAM` 과 `ENDCG` 블록 사이에 존재해야 한다. `vertex/fragment shader` 역시 이 문법을 사용하는 것 같다. 하지만 차이점이 존재한다.

* `CGPROGRAM` 및 `ENDCG` 는 `Pass` 가 아니라 `SubShader` 블록 안에서 선언이 되어야 한다. `SubShader` 는 한 쉐이더에 존재하는 여러 개의 `Pass` 을 가질 수 있는 여러 쉐이더를 지칭하는데, 플랫폼에 따라서 각기 다른 쉐이더가 선택되서 렌더링될 수가 있다고 한다.
  * [SubShader](https://docs.unity3d.com/Manual/SL-SubShader.html)
  * [Pass](https://docs.unity3d.com/Manual/SL-Pass.html)

* 또한 `CGPROGRAM` `ENDCG` 블록 안쪽에 `#pragma surface ...` 을 명시해서 이것이 `Surface shader` 임을 알려야 한다.

{% highlight csharp %}
#pragma surface surfaceFunction lightModel [optionalparams]
{% endhighlight %}

자세한 사항은 위 문서를 참고한다.

2. `Vertex and Fragment shader` 

> [Shaders: vertex and fragment programs](https://docs.unity3d.com/Manual/ShaderTut2.html) [Writing vertex and fragment shaders](https://docs.unity3d.com/Manual/SL-ShaderPrograms.html)

* `Vertex/Fragment shader` 타입은 유니티에서 제공하는 빛, 그림자 등과 상호작용을 하지 않는 쉐이더 타입을 말한다. 사실 의미 자체로만 보면 로우레벨 렌더링 파이프라인의 `VS` 와 `FS` 가 맞다. 이 쉐이더를 쓸 경우에는 위의 `Surface shader` 와 달리 `Pass` 안에 `CGPROGRAM` 과 `ENDCG` 가 있어도 된다.

다만 어느 것이 `Vertex` 이고 어느 것이 `Fragment` 임을 확인하기 위한 패스를 지정하기 위해서 `HLSL` 스니펫들을 `CGPROGRAM` 바로 다음에 지정해줘야 한다.

{% highlight csharp %}
#pragma vertex name // compile function name as the vertex shader.
#pragma fragment name // compile function name as the fragment shader.

// etc...
{% endhighlight %}

